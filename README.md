# Agriculture_prediction

### Beyond Visible Spectrum: AI for Agriculture 2025 XGboost方案
**一、目的**

这是一个**回归任务**。
- **预测目标：** 预测作物图像块中的**病害百分比**。（一个0到100之间的整数值。）
- **输入数据：**
    - 每个样本是一个高光谱图像块，存储在单独的 `.npy` 文件中。
    - 根据数据集描述，我们将使用 **100个有效光谱波段** 进行分析。

**二、XGBoost 方案流程**

以下是使用XGBoost解决此回归问题的详细步骤：

1. **环境设置**
2. **数据加载 (Data Loading)**
    
    - **标签加载：** 使用 `pandas` 读取 `train.csv`，得到每个图像文件名 (`id` 列) 和对应的病害百分比 (`label` 列)。
    - **图像数据加载：** 编写函数，根据 `train.csv` 中的文件名，逐个使用 `numpy.load()` 读取存储高光谱数据的 `.npy` 文件。假设每个文件包含一个三维数组 (例如：`高度 x 宽度 x 100个波段`)。
3. **特征工程 (Feature Engineering)**
    - **核心方法：** 将每个三维的高光谱图像块转换为一维的特征向量，以便XGBoost处理。
        - **主要特征：计算每个样本各波段的平均反射率。** 对每个图像样本 (例如 `128x128x100` 的数据)，分别计算其100个波段上所有像素的平均值。这样，每个样本就转换为一个包含100个特征值的一维向量。
    - **构建特征矩阵 `X`：** 将所有样本提取出的特征向量堆叠起来，形成一个形状为 `(样本数, 100)` 的特征矩阵。
    - **构建标签向量 `y`：** 从 `train.csv` 中提取对应的病害百分比，形成标签向量。
    - _(可能的其他特征):_
        - 每个波段的统计特征：标准差、中位数、最大/最小值等。
        - 植被指数 (VIs)：根据波段特性，研究并计算适用于这些高光谱数据的植被指数。
        - 主成分分析 (PCA)：对100个波段特征进行降维。
4. **数据预处理 (Data Preprocessing)**
    
    - **训练集/验证集划分：** 使用 `scikit-learn` 的 `train_test_split` 函数，将特征矩阵 `X` 和标签向量 `y` 划分为训练集 (`X_train`, `y_train`) 和验证集 (`X_val`, `y_val`)。这是评估模型性能和进行超参数调优的关键。
    - _(可选) 特征缩放：_ 虽然XGBoost对此不敏感，但有时使用 `StandardScaler` 对特征进行标准化可能有助于某些情况或加速收敛。
5. **模型训练 (Model Training)**
    - **选择模型：** 实例化 `xgboost.XGBRegressor()`。
    - **训练模型：** 在训练数据 (`X_train`, `y_train`) 上调用模型的 `fit()` 方法。
    - **早停策略 (Early Stopping)：** 在 `fit()` 方法中，通常会指定 `eval_set=[(X_val, y_val)]` 和 `early_stopping_rounds` 参数，以监控模型在验证集上的性能，防止过拟合，并自动确定最佳的树的数量。（这点我看不懂）
6. **超参数调优 
    
    - XGBoost有许多可以调整的参数，以优化模型性能，
        - `n_estimators` (树的数量，早停可以帮助确定)
        - `max_depth` (树的最大深度)
        - `learning_rate` (学习率，或称 `eta`)
        - `subsample` (构建每棵树时样本的抽样比例)
        - `colsample_bytree` (构建每棵树时特征的抽样比例)
        - `gamma` (节点分裂所需的最小损失降低)
        - `reg_alpha` (L1正则化项)
        - `reg_lambda` (L2正则化项)
    - **调优方法：** 可以使用 `scikit-learn` 中的 `GridSearchCV`、`RandomizedSearchCV`，或者更高级的库如 `Optuna`、`Hyperopt` 进行贝叶斯优化。目标是找到在验证集上表现最好的参数组合。
7. **模型评估 (Model Evaluation)**
    - **性能指标：** 使用合适的回归指标在**验证集** (`X_val`, `y_val`) 上评估调优后的模型。常用指标包括：
        - 均方根误差 (Root Mean Squared Error, RMSE)
        - 平均绝对误差 (Mean Absolute Error, MAE)
    - **特征重要性：** XGBoost可以输出特征的重要性排序，帮助理解哪些波段（或衍生的特征）对病害百分比的预测贡献最大。
8. **结果分析与迭代 (Analysis & Iteration)**
    - 分析模型在验证集上的预测误差，尝试理解模型在哪些情况下表现不佳。
    - 根据分析结果，考虑是否需要改进特征工程方法，尝试新的特征组合，或者进一步细化超参数调优。


目前的一点发现：跟数据集描述的不同，训练集的2217条数据和545条数据中都有不符合预期的（125，57，125）大小的数据，我们需要进行填充。考虑到我们的目标是预测病害百分比，以及我们选用的特征（各波段平均反射率）具体的措施：**具体操作建议：** `extract_features` 函数中，当遇到宽度为57的图像时，可以对每个波段（经过125选100波段之后）应用 反射填充或者是均值填充来进行两侧填充，将其宽度扩展到128。然后再计算这100个（已填充到128宽度）波段各自的平均值。
